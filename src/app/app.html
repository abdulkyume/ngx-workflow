<div class="header">
  <h1>NgxWorkflow Demo</h1>
  <div class="controls">
    <button (click)="addRandomNode()">Add Node</button>
    <button (click)="applyElkLayout()">ELK Layout</button>
    <button (click)="exportJSON()">Export JSON</button>
    <input type="file" accept="application/json" (change)="importJSON($event)" />
    <button (click)="exportPNG()">Export PNG</button>
    <button (click)="exportSVG()">Export SVG</button>
    <button (click)="clearFlow()">Clear All</button>
    <div style="border-left: 2px solid #ccc; margin: 0 8px;"></div>
    <button (click)="testZoomIn()">Zoom In</button>
    <button (click)="testZoomOut()">Zoom Out</button>
    <button (click)="testFitView()">Fit View</button>
    <button (click)="testSetCenter()">Center</button>
    <div style="border-left: 2px solid #ccc; margin: 0 8px;"></div>
    <button (click)="toggleTheme()">
      {{ currentTheme === 'light' ? 'ğŸŒ™' : currentTheme === 'dark' ? 'â˜€ï¸' : 'ğŸ–¥ï¸' }} Theme
    </button>
  </div>
</div>

<div class="flow-container">
  <ngx-workflow-diagram #diagram class="flow-diagram" [initialNodes]="nodes" [initialEdges]="edges"
    [initialViewport]="viewport" [minZoom]="0.5" [maxZoom]="2.0"
    [backgroundImage]="'https://images.unsplash.com/photo-1557683316-973673baf926?auto=format&fit=crop&w=1000&q=80'"
    [colorMode]="currentTheme" [edgeReconnectable]="true" [showExportControls]="true" [showLayoutControls]="true"
    [showMinimap]="true" [autoSave]="true" [autoSaveInterval]="1000" [maxVersions]="10"
    (nodeClick)="onNodeClick($event)" (nodesChange)="onNodesChange($event)" (edgesChange)="onEdgesChange($event)"
    (edgeDrop)="onEdgeDrop($event)">

    <!-- Node Toolbars for selected nodes -->
    <ngx-workflow-node-toolbar *ngFor="let node of selectedNodes" [nodeId]="node.id" position="top" align="center">
      <button (click)="deleteNode(node.id)" title="Delete Node">ğŸ—‘ï¸</button>
      <button (click)="duplicateNode(node.id)" title="Duplicate Node">ğŸ“‹</button>
      <button (click)="editNodeLabel(node.id)" title="Edit Properties">âœï¸</button>
    </ngx-workflow-node-toolbar>

    <!-- Info Panel (top-right) -->
    <ngx-workflow-panel position="top-right">
      <div class="panel-content">
        <h4>Diagram Info</h4>
        <div class="panel-text">
          <div>Nodes: {{ nodesCount }}</div>
          <div>Edges: {{ edgesCount }}</div>
          <div>Zoom: {{ viewport.zoom | number:'1.1-2' }}x</div>
        </div>
      </div>
    </ngx-workflow-panel>

    <!-- Legend Panel (bottom-left) -->
    <ngx-workflow-panel position="bottom-left">
      <div class="panel-content">
        <h4>Legend</h4>
        <div>
          <div class="legend-item">
            <div class="legend-color" style="background: #3b82f6;"></div>
            <span>Default Node</span>
          </div>
          <div class="legend-item">
            <div class="legend-color" style="background: #10b981;"></div>
            <span>Rounded Node</span>
          </div>
        </div>
      </div>
    </ngx-workflow-panel>

  </ngx-workflow-diagram>

  <!-- Version History Sidebar -->
  <ngx-workflow-version-history [diagram]="diagram"></ngx-workflow-version-history>
</div>

<div class="footer">
  <p>Nodes: {{ nodesCount }} | Edges: {{ edgesCount }} | Zoom: {{ viewport.zoom | number:'1.1-2' }}</p>
</div>